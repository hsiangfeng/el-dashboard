"use strict";(self["webpackChunkel_dashboard"]=self["webpackChunkel_dashboard"]||[]).push([[975],{6975:function(e,t,a){a.r(t),a.d(t,{default:function(){return D}});var s=a(3396),o=a(7139),r=a(9242);const l=e=>((0,s.dD)("data-v-53adf587"),e=e(),(0,s.Cn)(),e),i=l((()=>(0,s._)("h2",null,"產品列表",-1))),u={style:{padding:"14px"}},d={class:"bottom"},n={key:0},p={key:1},c=(0,s.Uk)(" 加入購物車 "),m=l((()=>(0,s._)("h3",null,"購物車",-1))),h={class:"text-end"},g=(0,s.Uk)(" 清空購物車 "),f={key:0},y=(0,s.Uk)("已套用優惠"),w={key:1},_={key:0},b={key:1},v=(0,s.Uk)(" 移除 "),S=(0,s.Uk)(" 送出 "),k=l((()=>(0,s._)("h3",null,"送出訂單",-1))),C={class:"text-end"},W=(0,s.Uk)("取消"),$=(0,s.Uk)("送出");function x(e,t,a,l,x,E){const V=(0,s.up)("ElImage"),U=(0,s.up)("ElButton"),D=(0,s.up)("ElCard"),q=(0,s.up)("ElCol"),z=(0,s.up)("ElRow"),T=(0,s.up)("ElTag"),j=(0,s.up)("ElTableColumn"),I=(0,s.up)("ElTable"),N=(0,s.up)("ElInput"),F=(0,s.up)("ElFormItem"),A=(0,s.up)("ElForm"),H=(0,s.Q2)("loading");return(0,s.wg)(),(0,s.iD)(s.HY,null,[i,(0,s.wy)(((0,s.wg)(),(0,s.j4)(z,{gutter:30},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(x.products,(e=>((0,s.wg)(),(0,s.j4)(q,{md:6,key:e.id},{default:(0,s.w5)((()=>[(0,s.Wm)(D,{class:"mb-1","body-style":{padding:"0px"}},{default:(0,s.w5)((()=>[(0,s.Wm)(V,{src:e.imageUrl},null,8,["src"]),(0,s._)("div",u,[(0,s._)("h3",null,(0,o.zw)(e.title),1),(0,s._)("div",d,[(0,s._)("div",null,[e.origin_price?((0,s.wg)(),(0,s.iD)("del",n," 原價 "+(0,o.zw)(e.origin_price)+" 元 ",1)):(0,s.kq)("",!0),e.price?((0,s.wg)(),(0,s.iD)("div",p," 現在只要 "+(0,o.zw)(e.price)+" 元 ",1)):(0,s.kq)("",!0)]),(0,s.Wm)(U,{type:"primary",plain:"",onClick:t=>E.addToCart(e.id,1)},{default:(0,s.w5)((()=>[c])),_:2},1032,["onClick"])])])])),_:2},1024)])),_:2},1024)))),128))])),_:1})),[[H,x.loadingStatus.products]]),(0,s.Wm)(z,{justify:"center"},{default:(0,s.w5)((()=>[(0,s.Wm)(q,{md:12},{default:(0,s.w5)((()=>[m,(0,s._)("div",h,[(0,s.Wm)(U,{type:"danger",plain:"",onClick:E.removeAllCart},{default:(0,s.w5)((()=>[g])),_:1},8,["onClick"])]),(0,s.wy)(((0,s.wg)(),(0,s.j4)(I,{data:x.carts.carts,"summary-method":E.getSummary,"show-summary":!0,"sum-text":"總計"},{default:(0,s.w5)((()=>[(0,s.Wm)(j,{prop:"product.title",label:"品名"},{default:(0,s.w5)((e=>[e.row.coupon?((0,s.wg)(),(0,s.iD)("span",f,[(0,s.Uk)((0,o.zw)(e.row.product.title)+" ",1),(0,s.Wm)(T,{type:"success"},{default:(0,s.w5)((()=>[y])),_:1})])):((0,s.wg)(),(0,s.iD)("span",w,(0,o.zw)(e.row.product.title),1))])),_:1}),(0,s.Wm)(j,{width:"100",prop:"qty",label:"數量"}),(0,s.Wm)(j,{prop:"final_total",label:"單價"},{default:(0,s.w5)((t=>[t.row.coupon?((0,s.wg)(),(0,s.iD)("span",_,(0,o.zw)(e.$filters.currency(t.row.final_total))+" (原價："+(0,o.zw)(e.$filters.currency(t.row.total))+") ",1)):((0,s.wg)(),(0,s.iD)("span",b,(0,o.zw)(e.$filters.currency(t.row.final_total)),1))])),_:1}),(0,s.Wm)(j,{width:"100",label:"功能"},{default:(0,s.w5)((e=>[(0,s.Wm)(U,{link:"",type:"danger",plain:"",onClick:t=>E.removeCart(e.row.id)},{default:(0,s.w5)((()=>[v])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","summary-method"])),[[H,x.loadingStatus.carts]]),(0,s.Wm)(A,{onSubmit:(0,r.iM)(E.addCouponCode,["prevent"]),class:"el-coupon",inline:!0},{default:(0,s.w5)((()=>[(0,s.Wm)(F,{label:"套用優惠券"},{default:(0,s.w5)((()=>[(0,s.Wm)(N,{modelValue:x.coupon_code,"onUpdate:modelValue":t[0]||(t[0]=e=>x.coupon_code=e),placeholder:"請輸入優惠卷"},null,8,["modelValue"])])),_:1}),(0,s.Wm)(F,null,{default:(0,s.w5)((()=>[(0,s.Wm)(U,{"native-type":"submit"},{default:(0,s.w5)((()=>[S])),_:1})])),_:1})])),_:1},8,["onSubmit"]),k,(0,s.wy)(((0,s.wg)(),(0,s.j4)(A,{ref:"form",model:x.form.user,rules:x.rules,onSubmit:(0,r.iM)(E.createOrder,["prevent"]),"label-position":"top"},{default:(0,s.w5)((()=>[(0,s.Wm)(F,{prop:"email",label:"Email"},{default:(0,s.w5)((()=>[(0,s.Wm)(N,{type:"email",modelValue:x.form.user.email,"onUpdate:modelValue":t[1]||(t[1]=e=>x.form.user.email=e),placeholder:"請輸入 Email"},null,8,["modelValue"])])),_:1}),(0,s.Wm)(F,{prop:"name",label:"姓名"},{default:(0,s.w5)((()=>[(0,s.Wm)(N,{type:"text",modelValue:x.form.user.name,"onUpdate:modelValue":t[2]||(t[2]=e=>x.form.user.name=e),placeholder:"請輸入姓名"},null,8,["modelValue"])])),_:1}),(0,s.Wm)(F,{prop:"tel",label:"收件人電話"},{default:(0,s.w5)((()=>[(0,s.Wm)(N,{type:"tel",modelValue:x.form.user.tel,"onUpdate:modelValue":t[3]||(t[3]=e=>x.form.user.tel=e),placeholder:"請輸入收件人電話"},null,8,["modelValue"])])),_:1}),(0,s.Wm)(F,{prop:"address",label:"收件人地址"},{default:(0,s.w5)((()=>[(0,s.Wm)(N,{type:"address",modelValue:x.form.user.address,"onUpdate:modelValue":t[4]||(t[4]=e=>x.form.user.address=e),placeholder:"請輸入收件人地址"},null,8,["modelValue"])])),_:1}),(0,s._)("div",C,[(0,s.Wm)(U,{type:"info",plain:""},{default:(0,s.w5)((()=>[W])),_:1}),(0,s.Wm)(U,{"native-type":"submit",type:"primary",plain:""},{default:(0,s.w5)((()=>[$])),_:1})])])),_:1},8,["model","rules","onSubmit"])),[[H,x.loadingStatus.orders]])])),_:1})])),_:1})],64)}var E={data(){return{loadingStatus:{products:!1,carts:!1,orders:!1},rules:{email:[{required:!0,message:"請輸入你的 Email",trigger:"blur"},{type:"email",message:"Email 格式有誤",trigger:"blur"}],name:[{required:!0,message:"請輸入你的名字",trigger:"blur"},{min:2,max:6,message:"最小 2 個字，最大 6 個字",trigger:"blur"}],tel:[{required:!0,message:"請輸入你的聯絡電話",trigger:"blur"},{min:8,max:10,message:"最短 8 碼 最長 10 碼",trigger:"blur"}],address:[{required:!0,message:"請輸入你的地址",trigger:"blur"},{min:4,message:"最短四個字",trigger:"blur"}]},products:[],carts:[],form:{user:{}},coupon_code:""}},methods:{getProducts(){this.loadingStatus.products=!0;const e="https://vue3-course-api.hexschool.io/v2/api/teaching-example/products";this.$http.get(e).then((e=>{this.products=e.data.products,this.loadingStatus.products=!1})).catch((e=>{this.loadingStatus.products=!1,this.$notify({title:"錯誤訊息",message:e.response.data.message,type:"error"})}))},addToCart(e,t){this.loadingStatus.products=!0;const a="https://vue3-course-api.hexschool.io/v2/api/teaching-example/cart",s={product_id:e,qty:t};this.$http.post(a,{data:s}).then((()=>{this.loadingStatus.products=!1,this.$notify({title:"購物車",message:"加入購物車成功",type:"success"}),this.getCart()})).catch((e=>{this.loadingStatus.products=!1,this.$notify({title:"錯誤訊息",message:e.response.data.message,type:"error"})}))},getCart(){this.loadingStatus.carts=!0;const e="https://vue3-course-api.hexschool.io/v2/api/teaching-example/cart";this.$http.get(e).then((e=>{this.carts=e.data.data,this.loadingStatus.carts=!1})).catch((e=>{this.loadingStatus.carts=!1,this.$notify({title:"錯誤訊息",message:e.response.data.message,type:"error"})}))},removeAllCart(){const e="https://vue3-course-api.hexschool.io/v2/api/teaching-example/carts";this.loadingStatus.carts=!0,this.$http.delete(e).then((()=>{this.loadingStatus.carts=!1,this.$notify({title:"購物車",message:"購物車已清空",type:"error"}),this.getCart()})).catch((e=>{this.loadingStatus.carts=!1,this.$notify({title:"錯誤訊息",message:e.response.data.message,type:"error"})}))},removeCart(e){this.loadingStatus.carts=!0;const t=`https://vue3-course-api.hexschool.io/v2/api/teaching-example/cart/${e}`;this.isLoading=!0,this.$http.delete(t).then((()=>{this.loadingStatus.carts=!1,this.$notify({title:"購物車",message:"商品已移除",type:"success"}),this.getCart()})).catch((e=>{this.isLoading=!1,this.$notify({title:"錯誤訊息",message:e.response.data.message,type:"error"})}))},createOrder(){this.loadingStatus.orders=!0;const e="https://vue3-course-api.hexschool.io/v2/api/teaching-example/order";this.$http.post(e,{data:this.form}).then((e=>{this.loadingStatus.orders=!1,this.$refs.form.resetFields(),this.$notify({title:"建立訂單",message:"訂單已建立，五秒後將會跳至付款頁面。",type:"success"}),window.setTimeout((()=>{this.$router.push(`/admin/user-checkout/${e.data.orderId}`)}),5e3)})).catch((e=>{this.loadingStatus.orders=!1,this.$notify({title:"錯誤訊息",message:e.response.data.message,type:"error"})}))},addCouponCode(){this.loadingStatus.coupon=!0;const e="https://vue3-course-api.hexschool.io/v2/api/teaching-example/coupon",t={code:this.coupon_code};this.$http.post(e,{data:t}).then((()=>{this.loadingStatus.coupon=!1,this.$notify({title:"優惠券",message:"優惠券已使用",type:"success"}),this.getCart()})).catch((e=>{this.loadingStatus.coupon=!1,this.$notify({title:"錯誤訊息",message:e.response.data.message,type:"error"})}))},getSummary({columns:e,data:t}){const a=[];return e.forEach(((e,s)=>{if(0===s)return void(a[s]="總計");const o=t.map((t=>Number(t[e.property])));if(!o.every((e=>Number.isNaN(e)))){const e=o.reduce(((e,t)=>e+t));a[s]=this.$filters.currency(e)}})),a}},mounted(){this.getProducts(),this.getCart()}},V=a(89);const U=(0,V.Z)(E,[["render",x],["__scopeId","data-v-53adf587"]]);var D=U}}]);
//# sourceMappingURL=975.2cd8d475.js.map